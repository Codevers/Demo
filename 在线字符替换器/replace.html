<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<!-- saved from url=(0054)http://media.njude.com.cn/pub/ZF_CPS/tool/replace.html -->
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    
    <title>在线字符转换器</title>
</head>

<body>
    <textarea name="" id="text" cols="100" rows="20" style="vertical-align:bottom;text-indent:0;line-height:1.7;"></textarea>
    <button style="width:80px;height:40px;" id="btn">转换</button>
    <script>
    document.getElementById('btn').onclick = function() {
        var getContent = document.getElementById('text').value;
        var s = getContent.replace(/((\d+\.?\d*)|(\d*\.\d+))\%/gi, function(num) {
                var n = parseFloat(num);
                return "百分之" + ChineseNum(n);
            })
            // .replace(/\d+/g, function(num) {
            //     return ChineseNum(num)
            // })
            .replace(/(?!0+(\.0+)?$)\d+(\.\d+)?/g,function(num){
            	console.log(num)
                return ChineseNum(num)
            })
            .replace(/，|。|：|、|？|：|．|\./g, '\n')
            .replace(/°|\./g, '度')
            .replace(/℃|\./g, '摄氏度')
            .replace(/\b(d)\b|\./g, '周')
            .replace(/\b(g)\b|\./gi, '克')
            .replace(/\b(kg)\b|\./gi, '千克')
            .replace(/\b(s)\b|\./gi, '秒')
            .replace(/\b(min)\b|\./gi, '分钟')
            .replace(/\b(ml)\b|\./gi, '毫升')
            .replace(/\b(cm)\b|\./gi, '厘米')
            .replace(/\b(m)\b|\./gi, '米')
            .replace(/\b(km)\b|\./gi, '千米')
        	.replace(/[\r\n\s\f\t\v\o ]+/gm, "\n") //删除空行
        document.getElementById('text').value = s;
    }

    //匹配阿拉伯数字为汉字
    function ChineseNum(num) {
        if (!/^\d*(\.\d*)?$/.test(num)) {
            alert("Number is wrong!");
            return "Number is wrong!";
        }
        var AA = new Array("零", "一", "二", "三", "四", "五", "六", "七", "八", "九");
        var BB = new Array("", "十", "百", "千", "万", "亿", "点", "");
        var a = ("" + num).replace(/(^0*)/g, "").split("."),
            k = 0,
            re = "";
        for (var i = a[0].length - 1; i >= 0; i--) {
            switch (k) {
                case 0:
                    re = BB[7] + re;
                    break;
                case 4:
                    if (!new RegExp("0{4}\\d{" + (a[0].length - i - 1) + "}$").test(a[0]))
                        re = BB[4] + re;
                    break;
                case 8:
                    re = BB[5] + re;
                    BB[7] = BB[5];
                    k = 0;
                    break;
            }
            if (k % 4 == 2 && a[0].charAt(i + 2) != 0 && a[0].charAt(i + 1) == 0) re = AA[0] + re;
            if (a[0].charAt(i) != 0) re = AA[a[0].charAt(i)] + BB[k % 4] + re;
            k++;
        }
        //添加：此处判断浮点数和整数，加零
        if(a[0]=="" && a.length>1){
        	re += AA[0] + BB[6];
            for (var i = 0; i < a[1].length; i++) re += AA[a[1].charAt(i)];
            return re;
        }else if(a.length > 1){
        	re += BB[6];
            for (var i = 0; i < a[1].length; i++) re += AA[a[1].charAt(i)];
            return re;
        }
        // if (a.length > 1) //加上小数部分(如果有小数部分)
        // {
        //     re += BB[6];
        //     for (var i = 0; i < a[1].length; i++) re += AA[a[1].charAt(i)];
        // }
        return re;
        
    }

    // alert(ChineseNum('15'))


</script>



</body></html>